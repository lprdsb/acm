# 2023.12.25

## [G2. Light Bulbs (Hard Version)](https://codeforces.com/contest/1914/problem/G2)

若干个区间的极小并，当且仅当这个区间包含了所有区间，当且仅当每个区间的左右点出现了一次， 相当于某个标号恰好出现两次，可以用随机数来异或。

## 因数个数小trick

$$
d(n)\%2=[n=k^2]
$$

当且仅当该数是完全平方数时，因数个数是奇数个

## 极小mex

![极小mex](F:\Documents\acm\picture\极小mex.png)

称$[l,r]$是极小区间，当且仅当不存在$[L,R]\subsetneq[l,r],\mbox{mex}(l,r)=\mbox{mex}(L,R)$。则有结论：极小区间只有$O(n)$个。

证明：考虑极小区间$[l,r]$，则$a_l\neq a_r$，设$a_l>a_r$，由于删掉端点$\mbox{mex}$会变化，所以$\mbox{mex}(l,r)>a_l$，对于$r_1>r$，若$a_{r_1}\leq a_r$，则$[l,r_1]$，$r_1$可以删去，其不为极小区间。若$a_{r_1}\ge a_r$，由于$\mbox{mex}(l,r_1)>a_{r_1}$，说明$a_{r_1}$已经出现过，仍然可以删去，其不为极小区间，故对于一个$l$来说，对应的$r$只有一个。

# 2023.12.31

## 数论trick

$$
F_n(x)=\prod_{i=0}^n(1-p^ix)
$$

可以考虑

$$
F_n(px)=\prod_{i=0}^{n}(1-p^{i+1}x)=\prod_{i=1}^{n+1}(1-p^ix)=F_n(x)\frac{1-p^{n+1}x}{1-x}
$$

即

$$
(1-x)F_n(px)=(1-p^{n+1}x)F_n(x)
$$

考虑$[x^k]$

$$
p^k[x^k]F_n-p^{k-1}[x^{k-1}]F_n=[x^k]F_n-p^{n+1}[x^{k-1}]F_n\\
(p^k-1)[x^k]F_n=(p^{k-1}-p^{n+1})[x^{k-1}]F_n\\
[x^k]F_n=\frac{p^{k-1}-p^{n+1}}{p^k-1}[x^{k-1}]F_n
$$

## [q-binomial](https://www.cnblogs.com/zkyJuruo/p/15515243.html)

$$
[n]_q = \sum\limits_{i=0}^{n-1} q^i = \lim_{x \rightarrow q} \frac{1-x^n}{1-x}, [ n ] !_q = \prod_{i=1}^n [i]_q, {n \brack m}_q = \frac {[n]!_q} {[m]!_q [n - m]!_q}\\
{n \brack m}_q = {n-1 \brack m-1}_q + q^m {n-1 \brack m}_q\\
\prod_{i=0}^{n-1} (1+q^iy) = \sum\limits_{i=0}^n q^{\binom{i}{2}} {n \brack i}_q y^i\\
{n + m \brack k}_q = \sum\limits_{i=0}^k q^{(n-i)(k-i)} {n \brack i}_q {m \brack k-i}_q\\
{n + m + 1 \brack n + 1}_q = \sum\limits_{i=0}^m q^i {n + i \brack n}_q\\
\frac{1}{\prod_{i=0}^n (1-q^ix)} = \sum\limits_{i \ge 0} x^i {i+n \brack n}_q
$$

### Erdos-Ginzburg-Ziv Theorem

![image-20231231191058535](C:\Users\lpr\AppData\Roaming\Typora\typora-user-images\image-20231231191058535.png)

https://zhuanlan.zhihu.com/p/501183534

$n$为任意正整数，则在任意$2n-1$个整数中，必定存在$n$个整数，它们的和是$n$的倍数。

# 2024.1.7

## 矩阵树

![image-20240107192512990](C:\Users\lpr\AppData\Roaming\Typora\typora-user-images\image-20240107192512990.png)

# 无向图

给定一个无向图，有重边无自环，$A$为其邻接矩阵，$D$为其度数矩阵。

其基尔霍夫矩阵为$D-A$。

$\det(K')$即为该无向图生成树数量，其中$K'$为任意一个$n-1$阶余子式。

# 有向图

给定一个无向图，有重边无自环，$A$为其邻接矩阵，$D_{in}$为其入度矩阵，$D_{out}$为其出度矩阵。

若为外向树$K=D_{in}-A$，若为内向树$K=D_{out}-A$。

以$r$为根的树的个数为$\det(K')$，$K'$为$(r,r)$的余子式。

## BEST定理

![image-20240107192535167](C:\Users\lpr\AppData\Roaming\Typora\typora-user-images\image-20240107192535167.png)

对于一个有向欧拉图，$i$点出度为$out_i$，其本质不同的欧拉回路个数为：

$$
T\prod_i(out_i-1)!
$$

$T$为图的内向生成树个数。

证明：

考虑一条欧拉回路，每个点最后一次出去的边，一定构成一颗内向树，考虑给每个点剩下的边使用的的先后排序。

对于欧拉路径，可以在两个起点之间连边，然后算欧拉回路。

## 连续段dp

[P5999 [CEOI2016] kangaroo](https://www.luogu.com.cn/problem/P5999)

# 2024_1_22

### dp trick

![image-20240122183502074](C:\Users\lpr\AppData\Roaming\Typora\typora-user-images\image-20240122183502074.png)

将一棵树分为$k$个联通块，计算$\prod_{i=1}^kS_i$的总和，可以考虑这样的$dp$，在$k$个连通块中，每个连通块选择一个点的方案数。

$dp[i][j][0/1]$表示$i$点为根的子树，分成$j$个连通块，$i$这个点的连通块中有没有放标记点。

# 2024_2_1

## 二维链表trick

可以开二位链表连右边和下边

## 括号序列

1.设$f(n,m,k)$表示有$n$个左括号，$m$个右括号，子序列中合法括号序列最长长度为$2k$的括号序列，转移为

$$
f(n,m,k)=
\left\{
\matrix{
{n+m}\choose n && k\ge min(n,m)\\
f(n-1,m,k-1)+f(n,m-1,k) && k<min(n,m)
}
\right.
$$

通过归纳可以得到

$$
f(n,m,k)=
\left\{
\matrix{
{n+m}\choose n && k\ge min(n,m)\\
{n+m}\choose k && k<min(n,m)
}
\right.
$$

2.对于一个括号序列来说，要想构造一个最长的合法子括号序列，没有用上的右括号的数量就是前缀和的min。可以考虑像算卡特兰数那样将跨过某条斜线之后的路径全部取反。

# 2024_2_18

$$
\max_{a\in A,b\in B}\{a\&b\}=\max_{x\in a\in A, x\in b \in B}\{x\}
$$

# 2024_3_16

## or_trick

$$
\max_{0\leq i \le a,0\le j\le b}i|j=(a | b)|(2^{\log(a\&b) + 1}-1)
$$

# 2024_3_19

序列trick

对于一个长度为$n$的$x,x,...,x+1,x+1$的序列，记他们的总和为$s$，则第$i$个数为$\lfloor\frac{s+i}{n}\rfloor$。


# 2024_4_22

## 固定边数最短路

考虑通过分层图dp，转移，而不是dij，对于有拓扑序的dp转移可以按顺序转移。

## 路径花费为最长$k$条边之和最短路

考虑枚举边长分界$x$，将所有边权变为$\max(0, w - x)$，新图最短路长度加$x*k$即为所求。

一方面，原题最短路在新图中合法。

另一方面，新图最短路花费高于原图相同路径。

$$
\sum_{i=1}^k w_i \leq \sum_{i=1}^n \max(0, w - x) + k*x
$$


# 2024_5_10 区间分配tric

考虑这样一个问题，$n$个区间，给每个$[l,r]$之间的点分配一个区间，要求每个区间可以分配给区间内的点，最多分配给一个点。

考虑化简，对于两个同左端点的区间$[a,b],[a,c],b\leq c$，那么效果完全等价于$[a,b],[a+1,c]$。经过这样的变化就不存在左端点相同的区间，对右端点也做相同的变换，那么所有的区间具有偏序关系，$l_i <l_j,r_i<r_j, i<j$。

判断某个区间$[l,r]$是否能被合法分配，只需要判断$[l,r]$里面的右端点数与跨过$r$的区间的数量之和是否大于区间的长度。

# 2024_5_27 满足某种性质的区间统计

统计序列上满足某种性质的区间数量，可以考虑把区间在线段树上分成log个子区间，分别考虑每个小区间满足某种性质。

# 2024_5_29 狄尔沃斯定理（偏序集）
偏序集中的反链是其元素两两不可比的子集，而链是其元素两两可比的子集。链分解是将偏序集中的元素划分为若干无交的链。狄尔沃斯定理指出，有限偏序集合中，包含元素最多反链的元素数等于包含链数最少的链分解的链数，这个量被定义为该偏序集的宽度。

对于任意有限偏序集，其最大反链中元素的数目必等于最小链划分中链的数目。此定理的对偶形式亦真，它断言：对于任意有限偏序集，其最长链中元素的数目必等于其最小反链划分中反链的数目。

# 2024_6_28 按时间顺序加边求强连通分量
对于按顺序加边，每次加边要求算出强连通分量一些性质的问题。
可以考虑对每条边在tarjan算法中被缩掉的时间分治。
对于每条边，设其加入时间为$ t_i $假设当前分治为[l,r]，先将$t_i \leq md$的边加入现在的图中，看其是否被tarjan缩掉。
若是，说明其缩掉的时间在前，加入左分治。若否，则加入右分治。
每次分治要像cdq分治那样保留左分治区间做的tarjan缩点，去处理右区间。

[1989F](https://codeforces.com/contest/1989/submission/267848075)

# 2024_7_19 无向图n个点路径不重配对
可以考虑对无向图建出生成树，转化成在树上的点路径配对的形式。
考虑树上配对，可以像dp一样对某个子树配对，会决定留不留一个点使用父亲这条边。

# 2024_7_31 无平方字串构造
用0，1，2构造无平方子串，a_i=popcount(i-1)-popcount(i)+1

# 2024_8_4 费马点（到三角形顶点之和最小的点）
1.如果有度数大于120的角，则该点为费马点。
2.否则为某条边为底边往外作正三角形，将外面的点与这条边以外的那个点连线就为最短长度。 

$$f(X, \, Y, \, Z) = \sqrt{\frac{a^2+b^2+c^2+4\sqrt{3}S}{2}}.$$
![111](https://mmbiz.qpic.cn/sz_mmbiz_jpg/4ahGexcaNnhCxput1TUh6Ndq2icTS0BbnrXloD7flgT2PKdzbq5BMekZibgVPyuZiczhu8xcg5CrbcqRLeC3y9Ntw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

# 2024_8_4 求单调上升总和为n的数列的方案数
可以考虑数列总长不超过根号级别。
考虑dp, $ f_{i,j} $表示，长度为i总和为j的方案数，每次转移为添加一个数或者把所有数加1。

# 2024_9_29 前缀添加0前缀加数trick Codeforces Round 975 (Div. 1) E

考虑维护一个数列，支持在数列首位插入0，前缀加1，要求维护关于前缀最大值的信息。

考虑增量维护，第一种操作不会改变信息。
对于第二种操作，考虑当前前缀最大值的idx是p1,p2,p3,...,且维护每个最大值与前一个的差值，假设对[1,k]进行加1，那么对于$p_i\leq k$仍然是前缀最大值，且差分不变，对于大于k
的第一个p，会导致差分-1，当差分为0时将其删除。
这样可以用并查集维护，初始数列全为1，要求将某些1变成0，每次求在某个数字后面的第一个1。

# 2024_9_29 数列查询trick

对于这么一个未知值的数列：
$$
a_i\ge a_{i-1}\\
a_i\leq \frac{n}{i}。
$$
可以在$n\sqrt{n}$次询问问出每个点的值。

具体的，假设当前想知道[l,r]区间的值，可以问md的值，若$a_l\not = a_{md}$,则递归问左边，对于右边也同样操作。
这样可以保证询问次数满足要求。

考虑值变化的位置，类似整除分块，只会变化$\sqrt{n}$个位置，这些位置形成的二叉搜索虚数是线性的。

# 2024_10_24 范德蒙德卷积
$$
\sum_{i=0}^n {n\choose i}{m\choose i}=\sum_{i=0}^n {n\choose n-i}{m\choose i}={n+m\choose n}
$$